const cron = require("node-cron");

// Schedule a cron job to run on the first day of each month at 00:00
cron.schedule("0 0 1 * *", async () => {
  try {
    // Retrieve all verified users
    const verifiedUsers = await User.find({ verified: true });

    // Perform the monthly update for each verified user
    for (const user of verifiedUsers) {
      const currentMonth = new Date().getMonth();
      const lastUpdatedMonth = user.updatedAt.getMonth();

      if (currentMonth !== lastUpdatedMonth) {
        // Add 30 new coins to the wallet
        if (!user.wallet) {
          user.wallet = { freeCoins: 30 };
        } else {
          user.wallet.freeCoins = 30;
        }

        // Save the updated user
        await user.save();
      }
    }
  } catch (error) {
    console.error("Monthly update error:", error);
  }
});